<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Search Results</h1>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loadingSpinner">
            <p>Loading results...</p>
        </div>

        <!-- Results Box -->
        <div class="results-box">
            <div id="resultsContainer" aria-live="polite">
                <!-- Search results will be displayed here -->
            </div>
        </div>

        <a href="index.html" class="back-btn">Back to Search</a>
    </div>

    <script>
    // Extract search query from URL
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get('query');
    const sortOption = urlParams.get('sort');

    if (!searchQuery) {
        document.getElementById('resultsContainer').innerHTML = '<p>Error: No search query provided.</p>';
        throw new Error("Search query is missing from URL parameters.");
    }

    console.log("Search Query:", searchQuery);
    console.log("Sort Option:", sortOption);

    // Load JSON Data
    fetch('https://raw.githubusercontent.com/yprosperi/auto-part-cross-referencing/main/assets/cross_reference.json')
        .then(response => response.json())
        .then(partsData => {
            console.log("Data Loaded:", partsData); // Debugging Step
            
            let filteredParts = partsData.filter(part => 
                part['Part Number']?.toUpperCase().includes(searchQuery.toUpperCase()) ||
                part.Description?.toUpperCase().includes(searchQuery.toUpperCase()) ||
                part.Manufacturer?.toUpperCase().includes(searchQuery.toUpperCase()) ||
                part.Vehicle?.toUpperCase().includes(searchQuery.toUpperCase())
            );

            console.log("Filtered Parts:", filteredParts); // Debugging Step

            // Apply sorting if selected
            if (sortOption === 'manufacturer') {
                filteredParts.sort((a, b) => a.Manufacturer.localeCompare(b.Manufacturer));
            } else if (sortOption === 'description') {
                filteredParts.sort((a, b) => a.Description.localeCompare(b.Description));
            }

            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            document.getElementById('loadingSpinner').style.display = "none"; // Hide spinner

            if (filteredParts.length === 0) {
                resultsContainer.innerHTML = '<p>No results found.</p>';
                return;
            }

            const ul = document.createElement('ul');
            filteredParts.forEach(part => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <h3>${part.Description} (${part.Manufacturer})</h3>
                    <p>Part Number: ${part['Part Number']}</p>
                    <p>Vehicle: ${part.Vehicle}</p>
                `;
                ul.appendChild(li);
            });
            resultsContainer.appendChild(ul);
        })
        .catch(error => {
            document.getElementById('resultsContainer').innerHTML = '<p>Error loading results.</p>';
            console.error('Error:', error);
        });
    </script>
</body>
</html>

